# 搜索页改造说明（系统输入法）

## 目标

- 搜索框支持直接输入。
- 搜索框被激活时调用系统输入法。
- 保留现有搜索流程（搜索历史、热门搜索、进入结果页）。

## 现状解读

当前搜索页由 `SearchTab` 承载两种状态：

- `SearchKeyboardView`：输入与选择阶段。
- `SearchResultsView`：搜索结果阶段。

原本 `SearchKeyboardView` 顶部“输入框”只是文本展示容器，不是可编辑控件，因此不会触发系统输入法；输入主要依赖页面内置字母数字键盘按钮。

## 本次改动

改动文件：

- `lib/screens/home/search/search_keyboard_view.dart`

关键变更：

- 顶部展示容器替换为 `TextField`，可直接输入。
- 新增 `TextEditingController` 与输入框 `FocusNode`，统一同步 `_searchText`。
- 输入框获得焦点时，通过 `SystemChannels.textInput.invokeMethod('TextInput.show')` 主动请求系统输入法。
- 保留原有“清空/后退/搜索”和内置键盘逻辑，且与 `TextField` 文本保持同步。
- 保留原有返回键与左方向键导航行为（可回侧栏/主页）。

## 交互结果

- 遥控器将焦点移动到搜索框后，会触发系统输入法（设备支持时）。
- 直接输入会实时更新搜索词，并沿用现有建议词请求逻辑。
- 提交（搜索 action）后，沿用现有历史记录与结果跳转逻辑。

## 后续修改建议

- 若后续决定完全使用系统输入法，可移除内置字母数字键盘区，进一步简化焦点导航代码。
- 若要优化体验，可把建议词 `_suggestions` 显示在输入框下方，减少输入成本。
- 建议补一个 Android TV 真机回归清单：焦点进入、返回键、输入法弹起、提交搜索。

## 粗略 Token 节省估算

以“未来同类需求（输入框/焦点/系统输入法）”为例，若没有这份文档，通常每次都要重新解释现状和边界。

- 无文档时：一次沟通 + 代码说明约 `900~1500` tokens。
- 有文档时：引用本文档 + 少量差异说明约 `250~500` tokens。

单次可节省约 `650~1000` tokens。  
如果后续出现 5 次类似修改，累计大约可节省 `3250~5000` tokens（粗估）。
